name: Bootstrap Repository Structure

on:
  workflow_dispatch:
    inputs:
      branch:
        description: "Branch to create/use for bootstrap PR"
        required: true
        default: "chore/bootstrap"
      commit_message:
        description: "Commit message"
        required: true
        default: "chore: bootstrap LIK repository structure"

permissions:
  contents: write
  pull-requests: write

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Generate installation token
        id: app_token
        uses: tibdex/github-app-token@v2
        with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.APP_PRIVATE_KEY }}
          installation_id: ${{ secrets.APP_INSTALLATION_ID }}

      - name: Set git identity
        run: |
          git config user.name "lik-app[bot]"
          git config user.email "lik-app[bot]@users.noreply.github.com"

      - name: Create or switch branch
        run: |
          BRANCH="${{ github.event.inputs.branch }}"
          if git ls-remote --exit-code --heads origin "$BRANCH" >/dev/null 2>&1; then
            git checkout "$BRANCH"
            git pull origin "$BRANCH"
          else
            git checkout -b "$BRANCH"
          fi

      - name: Create folders
        run: |
          mkdir -p 00_ADMIN/OKR 00_ADMIN/MEETINGS
          mkdir -p 01_FOUNDATION/STRATEGY 01_FOUNDATION/BRAND/Logo 01_FOUNDATION/LEGAL/Contracts 01_FOUNDATION/FINANCE 01_FOUNDATION/RESEARCH
          mkdir -p 10_PROJECT_A_Health_Diagnostics/PRODUCT/Protocols 10_PROJECT_A_Health_Diagnostics/PRODUCT/Reports 10_PROJECT_A_Health_Diagnostics/OPS/Lab_Partners 10_PROJECT_A_Health_Diagnostics/OPS/Compliance 10_PROJECT_A_Health_Diagnostics/DATA_MODELS 10_PROJECT_A_Health_Diagnostics/METRICS
          mkdir -p 20_PROJECT_B_Nutrition_Fitness/LIBRARY/MealPlans 20_PROJECT_B_Nutrition_Fitness/LIBRARY/TrainingPlans 20_PROJECT_B_Nutrition_Fitness/PERSONALIZATION 20_PROJECT_B_Nutrition_Fitness/SUPPLEMENTS
          mkdir -p 30_PROJECT_C_App_Monitoring/SPECS/Integrations 30_PROJECT_C_App_Monitoring/UX/Wireframes 30_PROJECT_C_App_Monitoring/SECURITY 30_PROJECT_C_App_Monitoring/ANALYTICS
          mkdir -p 40_PROJECT_D_Psych_Productivity/PROTOCOLS 40_PROJECT_D_Psych_Productivity/ETHICS
          mkdir -p 50_PROJECT_E_Edtech_Career/CURRICULA 50_PROJECT_E_Edtech_Career/IDP 50_PROJECT_E_Edtech_Career/B2B
          mkdir -p 60_PROJECT_F_Finance_Legal/FINANCE 60_PROJECT_F_Finance_Legal/LEGAL_SERVICES
          mkdir -p 70_PROJECT_G_Environment_Style/SERVICES 70_PROJECT_G_Environment_Style/PARTNERS
          mkdir -p 80_PROJECT_H_Institute_DivinePlan/CHARTER 80_PROJECT_H_Institute_DivinePlan/LIBRARY/Sources 80_PROJECT_H_Institute_DivinePlan/COURSES 80_PROJECT_H_Institute_DivinePlan/PUBLICATIONS
          mkdir -p 90_SHARED_RESOURCES/TEMPLATES 90_SHARED_RESOURCES/ADR 90_SHARED_RESOURCES/EXPORTS/Presentations 90_SHARED_RESOURCES/EXPORTS/PDFs
          mkdir -p .github/ISSUE_TEMPLATE

      - name: Create files
        run: |
          printf "%s\n" "### ЛИК — Лидерско‑интеграционная страна" "" "Репозиторий структуры проектов A–H, общих документов и процессов." "- Статус: Active" "- Язык: RU (EN/UA позже)" > README.md

          printf "%s\n" "### 00_ADMIN" "Администрирование: управление, роли, дорожные карты, встречи, изменения." > 00_ADMIN/README.md
          printf "%s\n" "### Governance" "Роли, процессы принятия решений (ADR), правила репозитория." > 00_ADMIN/GOVERNANCE.md
          printf "%s\n" "### Team" "Состав и контакты (заполнить)." > 00_ADMIN/TEAM.md
          printf "%s\n" "### Roadmap (высокоуровневая)" "Волна 1: A/B/C; Волна 2: D/E; Волна 3: F/G; Параллельно: H." > 00_ADMIN/ROADMAP.md
          printf "%s\n" "### OKR 2025 Q4" "O1: Запуск MVP A+B+C; KR: 20 пилотов, NPS>50." > 00_ADMIN/OKR/OKR_2025_Q4_v1.0.md
          printf "%s\n" "### Kickoff 2025-10-23" "Утверждена структура репозитория и правила версионирования." > 00_ADMIN/MEETINGS/2025-10-23_kickoff_minutes.md
          printf "%s\n" "# Changelog (00_ADMIN)" "## [1.0.0] - 2025-10-23" "- Инициализация раздела" > 00_ADMIN/CHANGELOG.md

          printf "%s\n" "### 01_FOUNDATION" "Визия, стратегия, бренд, юридика, финансы, исследования." > 01_FOUNDATION/README.md
          printf "%s\n" "### Визия ЛИК" "Поиск, развитие и поддержка лидеров; раскрытие потенциала (тело‑разум‑дух)." > 01_FOUNDATION/VISION.md
          printf "%s\n" "### Стратегия v1.0" "Старт: HealthTech (A+B+C), затем D/E, потом F/G; H — параллельно." > 01_FOUNDATION/STRATEGY/Strategy_v1.0.md
          printf "%s\n" "### GTM v1.0" "ICP: high performers 25–55, топ‑менеджеры, фаундеры, B2B." > 01_FOUNDATION/STRATEGY/GTM_v1.0.md
          printf "%s\n" "### Политика конфиденциальности (черновик)" "Минимизация, шифрование, роли доступа." > 01_FOUNDATION/LEGAL/PrivacyPolicy_v1.0.md
          printf "%s\n" "### Условия использования (черновик)" "Wellness/коучинг; не замещает медицинскую помощь." > 01_FOUNDATION/LEGAL/TermsOfService_v1.0.md
          : > 01_FOUNDATION/FINANCE/UnitEconomics_v1.0.xlsx
          : > 01_FOUNDATION/FINANCE/PricingMatrix_v1.1.xlsx
          printf "%s\n" "### Обзор рынка v1.0" "Сегменты HealthTech/EdTech/Wellness." > 01_FOUNDATION/RESEARCH/MarketOverview_v1.0.md
          printf "%s\n" "### Карта конкурентов v1.0" "Решения по модулям A–H." > 01_FOUNDATION/RESEARCH/CompetitorMap_v1.0.md
          printf "%s\n" "### Источники и ссылки" "(добавлять по мере работы)" > 01_FOUNDATION/RESEARCH/References.md

          printf "%s\n" "### Проект A: Диагностика и персональное здоровье" "MVP: чекап + персональные протоколы + коучинг + мониторинг." > 10_PROJECT_A_Health_Diagnostics/README.md
          printf "%s\n" "### MVP Spec v1.0 (Проект A)" "Комбо-чекап, персональные рекомендации, 8–12 недель сопровождения." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/MVP_Spec_v1.0.md
          printf "%s\n" "### Базовый чекап v1.2" "ОАК, липиды, HbA1c, TSH, CRP, ферритин, печёночные, почечные; сон/стресс по wearables." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/Protocols/Checkup_Basic_v1.2.md
          printf "%s\n" "### Расширенный чекап v1.0" "Гормоны, нутриенты, омега-индекс, микробиом (add-on), кардио-скрининг по рискам." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/Protocols/Checkup_Advanced_v1.0.md
          printf "%s\n" "### ДНК модуль v0.9" "Генетические панели как add-on с клинической интерпретацией." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/Protocols/DNA_AddOn_v0.9.md
          printf "%s\n" "### Скрипты коучинга v1.0" "Онбординг, цели, еженедельные ревью, коррекция." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/Coaching_Scripts_v1.0.md
          printf "%s\n" "### Шаблон отчёта клиента v1.1" "Цели, биомаркеры, рекомендации, прогресс, следующие шаги." > 10_PROJECT_A_Health_Diagnostics/PRODUCT/Reports/ClientReport_template_v1.1.md
          printf "%s\n" "name,country,contact,notes" > 10_PROJECT_A_Health_Diagnostics/OPS/Lab_Partners/PartnerList_v1.0.csv
          printf "%s\n" "### Позиционирование как wellness v1.0" "Без диагностики заболеваний; маршрутизация к врачам при red flags." > 10_PROJECT_A_Health_Diagnostics/OPS/Compliance/Wellness_Positioning_v1.0.md
          printf "%s\n" "# Схема биомаркеров v1.0" "biomarkers:" "  - id: hbA1c" "    unit: \"%\"" > 10_PROJECT_A_Health_Diagnostics/DATA_MODELS/Biomarkers_schema_v1.0.yaml
          printf "%s\n" "# Схема анкет онбординга v1.0" "forms:" "  - id: lifestyle" "    fields: []" > 10_PROJECT_A_Health_Diagnostics/DATA_MODELS/IntakeForms_schema_v1.0.yaml
          printf "%s\n" "### KPI v1.0" "Retention, NPS, выполнение планов, улучшения по биомаркерам." > 10_PROJECT_A_Health_Diagnostics/METRICS/KPI_Definitions_v1.0.md
          printf "%s\n" "### Дашборд v1.0" "Цели → метрики → рекомендации → коррекция." > 10_PROJECT_A_Health_Diagnostics/METRICS/Dashboard_Spec_v1.0.md
          printf "%s\n" "# Changelog (A)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры и документов v1" > 10_PROJECT_A_Health_Diagnostics/CHANGELOG.md

          printf "%s\n" "### Проект B: Питание и физнагрузки" "Библиотека планов, персонализация, нутрацевтики." > 20_PROJECT_B_Nutrition_Fitness/README.md
          printf "%s\n" "### План питания: снижение веса 12 недель v1.0" "(черновик)" > 20_PROJECT_B_Nutrition_Fitness/LIBRARY/MealPlans/WeightLoss_12w_v1.0.md
          printf "%s\n" "### План питания: энергия и фокус 8 недель v1.0" "(черновик)" > 20_PROJECT_B_Nutrition_Fitness/LIBRARY/MealPlans/EnergyFocus_8w_v1.0.md
          printf "%s\n" "### Тренировки: сила 12 недель v1.0" "(черновик)" > 20_PROJECT_B_Nutrition_Fitness/LIBRARY/TrainingPlans/Strength_12w_v1.0.md
          printf "%s\n" "### Тренировки: кардио 8 недель v1.0" "(черновик)" > 20_PROJECT_B_Nutrition_Fitness/LIBRARY/TrainingPlans/Cardio_8w_v1.0.md
          printf "%s\n" "### Правила персонализации v1.0" "Алгоритмы адаптации планов под цели и данные клиента." > 20_PROJECT_B_Nutrition_Fitness/PERSONALIZATION/Rules_v1.0.md
          printf "%s\n" "### Спецификация алгоритма v0.9" "Входы: анкеты, wearables, чекапы. Выход: план и nudges." > 20_PROJECT_B_Nutrition_Fitness/PERSONALIZATION/Algorithm_Spec_v0.9.md
          printf "%s\n" "### Протоколы нутрацевтиков v1.0" "Назначение по показаниям, контроль качества." > 20_PROJECT_B_Nutrition_Fitness/SUPPLEMENTS/Protocols_v1.0.md
          printf "%s\n" "name,country,contact,notes" > 20_PROJECT_B_Nutrition_Fitness/SUPPLEMENTS/Partners_v1.0.csv
          printf "%s\n" "# Changelog (B)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 20_PROJECT_B_Nutrition_Fitness/CHANGELOG.md

          printf "%s\n" "### Проект C: Приложение и мониторинг" "Интеграции, коуч-чат, отчёты, безопасность данных." > 30_PROJECT_C_App_Monitoring/README.md
          printf "%s\n" "### PRD App v1.0" "Сбор данных, дашборды, nudges, коуч-чат." > 30_PROJECT_C_App_Monitoring/SPECS/PRD_App_v1.0.md
          printf "%s\n" "### Интеграция Apple Health v1.0" "Диапазон метрик и разрешения." > 30_PROJECT_C_App_Monitoring/SPECS/Integrations/AppleHealth_v1.0.md
          printf "%s\n" "### Интеграция Oura v1.0" "Сон, readiness, активность." > 30_PROJECT_C_App_Monitoring/SPECS/Integrations/Oura_v1.0.md
          printf "%s\n" "### Политика безопасности данных v1.0" "Шифрование, доступы, хранение секретов, DPIA." > 30_PROJECT_C_App_Monitoring/SECURITY/DataSecurityPolicy_v1.0.md
          printf "%s\n" "### DPIA v1.0" "Оценка влияния на защиту данных." > 30_PROJECT_C_App_Monitoring/SECURITY/DPIA_v1.0.md
          printf "%s\n" "# Таксономия событий v1.0" "events: []" > 30_PROJECT_C_App_Monitoring/ANALYTICS/Events_Taxonomy_v1.0.yaml
          printf "%s\n" "### Пайплайн метрик v1.0" "Сбор → хранение → визуализация." > 30_PROJECT_C_App_Monitoring/ANALYTICS/Metrics_Pipeline_v1.0.md
          printf "%s\n" "# Changelog (C)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 30_PROJECT_C_App_Monitoring/CHANGELOG.md

          printf "%s\n" "### Проект D: Психология и продуктивность" "Скрининги, CBT/ACT, коучинг фокуса и энергии." > 40_PROJECT_D_Psych_Productivity/README.md
          printf "%s\n" "### Психо-скрининг v1.0" "Анкеты, шкалы, критерии." > 40_PROJECT_D_Psych_Productivity/PROTOCOLS/Screening_v1.0.md
          printf "%s\n" "### CBT/ACT протоколы v1.0" "Стандартизированные вмешательства для wellness." > 40_PROJECT_D_Psych_Productivity/PROTOCOLS/CBT_ACT_v1.0.md
          printf "%s\n" "### Коучинг продуктивности v1.0" "Фокус, приоритезация, календарь, энерджи-менеджмент." > 40_PROJECT_D_Psych_Productivity/PROTOCOLS/Productivity_Coaching_v1.0.md
          printf "%s\n" "### Политика эскалации v1.0" "Маршрутизация при red flags к клиницистам." > 40_PROJECT_D_Psych_Productivity/ETHICS/EscalationPolicy_v1.0.md
          printf "%s\n" "### Red Flags v1.0" "Список красных флагов и пути направления." > 40_PROJECT_D_Psych_Productivity/ETHICS/RedFlags_Routing_v1.0.md
          printf "%s\n" "# Changelog (D)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 40_PROJECT_D_Psych_Productivity/CHANGELOG.md

          printf "%s\n" "### Проект E: Обучение и карьера" "Курсы, IDP, карьерная аналитика, B2B-академии." > 50_PROJECT_E_Edtech_Career/README.md
          printf "%s\n" "### Лидерская продуктивность v1.0" "Контуры курса." > 50_PROJECT_E_Edtech_Career/CURRICULA/Leadership_Productivity_v1.0.md
          printf "%s\n" "### Принятие решений v1.0" "Контуры курса." > 50_PROJECT_E_Edtech_Career/CURRICULA/DecisionMaking_v1.0.md
          printf "%s\n" "### Шаблон IDP v1.0" "Цели → навыки → проекты → метрики." > 50_PROJECT_E_Edtech_Career/IDP/IDP_Template_v1.0.md
          printf "%s\n" "skill,level,notes" > 50_PROJECT_E_Edtech_Career/IDP/SkillsMatrix_v1.0.csv
          printf "%s\n" "### Предложение корпоративной академии v1.0" "Форматы, цены, KPI." > 50_PROJECT_E_Edtech_Career/B2B/CorporateAcademy_Offer_v1.0.md
          printf "%s\n" "### Шаблон кейса v1.0" "Проблема → Решение → Результат (KPI)." > 50_PROJECT_E_Edtech_Career/B2B/CaseStudy_Template_v1.0.md
          printf "%s\n" "# Changelog (E)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 50_PROJECT_E_Edtech_Career/CHANGELOG.md

          printf "%s\n" "### Проект F: Финансы и юрподдержка" "Финпланы, страхование, договоры, партнёрская сеть." > 60_PROJECT_F_Finance_Legal/README.md
          printf "%s\n" "### Шаблон финплана v1.0" "Бюджет, цели, инвестиции." > 60_PROJECT_F_Finance_Legal/FINANCE/PersonalPlan_Template_v1.0.md
          printf "%s\n" "### Гид по страхованию v1.0" "Типы полисов, критерии выбора." > 60_PROJECT_F_Finance_Legal/FINANCE/Insurance_Guide_v1.0.md
          printf "%s\n" "### Индекс шаблонов договоров v1.0" "NDA, партнёрские соглашения, оферты." > 60_PROJECT_F_Finance_Legal/LEGAL_SERVICES/ContractTemplates_Index_v1.0.md
          printf "%s\n" "name,country,contact,service" > 60_PROJECT_F_Finance_Legal/LEGAL_SERVICES/PartnerNetwork_v1.0.csv
          printf "%s\n" "# Changelog (F)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 60_PROJECT_F_Finance_Legal/CHANGELOG.md

          printf "%s\n" "### Проект G: Среда, стиль, логистика" "Здоровый дом/офис, логистика, стиль под цели." > 70_PROJECT_G_Environment_Style/README.md
          printf "%s\n" "### Healthy Home v1.0" "Воздух, свет, шум, материалы." > 70_PROJECT_G_Environment_Style/SERVICES/HealthyHome_Spec_v1.0.md
          printf "%s\n" "### Оптимизация рабочего места v1.0" "Эргономика, свет, шум, микропаузи." > 70_PROJECT_G_Environment_Style/SERVICES/Workspace_Optimization_v1.0.md
          printf "%s\n" "name,country,contact,notes" > 70_PROJECT_G_Environment_Style/PARTNERS/Interior_Designers_v1.0.csv
          printf "%s\n" "name,country,contact,notes" > 70_PROJECT_G_Environment_Style/PARTNERS/Logistics_v1.0.csv
          printf "%s\n" "# Changelog (G)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 70_PROJECT_G_Environment_Style/CHANGELOG.md

          printf "%s\n" "### Проект H: Институт изучения Божественного Плана" "Академическая независимость, методология, публикации." > 80_PROJECT_H_Institute_DivinePlan/README.md
          printf "%s\n" "### Миссия и методология v1.0" "Межконфессиональный, академический подход, открытая методология." > 80_PROJECT_H_Institute_DivinePlan/CHARTER/Mission_Methodology_v1.0.md
          printf "%s\n" "### Этический кодекс v1.0" "Уважение традиций, честность, отсутствие политизации." > 80_PROJECT_H_Institute_DivinePlan/CHARTER/EthicsCode_v1.0.md
          printf "%s\n" "### Совет (черновик)" "Роли, критерии участия." > 80_PROJECT_H_Institute_DivinePlan/CHARTER/AdvisoryBoard_v1.0.md
          printf "%s\n" "### Канон/индекс источников v1.0" "Писания, комментарии, жития, академические труды." > 80_PROJECT_H_Institute_DivinePlan/LIBRARY/Canon_Index_v1.0.md
          printf "%s\n" "### Вводный курс v1.0" "Структура, темы, литература." > 80_PROJECT_H_Institute_DivinePlan/COURSES/IntroCourse_v1.0.md
          printf "%s\n" "### Конспекты лекций v1.0" "Оглавление, тезисы, библиография." > 80_PROJECT_H_Institute_DivinePlan/COURSES/Lecture_Outlines_v1.0.md
          printf "%s\n" "### Отчёт о тенденциях 2025 v0.1" "Черновик методологии и гипотез." > 80_PROJECT_H_Institute_DivinePlan/PUBLICATIONS/Trends_Report_2025_v0.1.md
          printf "%s\n" "# Changelog (H)" "## [1.0.0] - 2025-10-23" "- Инициализация структуры" > 80_PROJECT_H_Institute_DivinePlan/CHANGELOG.md

          printf "%s\n" "### 90_SHARED_RESOURCES" "Шаблоны, ADR, экспортируемые материалы." > 90_SHARED_RESOURCES/README.md
          printf "%s\n" "# {Папка/Проект}: описание" "Статус: Draft/Active/Deprecated" "Ответственные:" "Цель:" "Содержимое:" "Ссылки:" > 90_SHARED_RESOURCES/TEMPLATES/README_Template.md
          printf "%s\n" "# Changelog" "SemVer (X.Y.Z), даты YYYY-MM-DD." "## [1.0.0] - 2025-10-23" "- Initial" > 90_SHARED_RESOURCES/TEMPLATES/CHANGELOG_Template.md
          printf "%s\n" "# ADR-XXXX: {Тема}" "Дата: YYYY-MM-DD" "Статус: Proposed | Accepted | Deprecated" "Контекст:" "Решение:" "Альтернативы:" "Аргументация:" "Влияния/Риски:" "Связанные документы:" > 90_SHARED_RESOURCES/TEMPLATES/ADR_Template.md
          printf "%s\n" "# Встреча: {тема}" "Дата/время:" "Участники:" "Повестка:" "Итоги/решения:" "Действия/ответственные/сроки:" "Ссылки:" > 90_SHARED_RESOURCES/TEMPLATES/MeetingMinutes_Template.md
          printf "%s\n" "# Отчёт клиента: {ФИО/ID}" "Период:" "Цели:" "Метрики/биомаркеры:" "Рекомендации:" "Прогресс/корректировки:" "Следующие шаги:" > 90_SHARED_RESOURCES/TEMPLATES/ClientReport_Template.md
          printf "%s\n" "# ADR-0001: Структура репозитория и версионирование" "Дата: 2025-10-23" "Статус: Accepted" "Решение: структура папок A–H, 00/01/90; SemVer в именах; CHANGELOG per проект." > 90_SHARED_RESOURCES/ADR/ADR_0001_repo_structure_v1.0.md

          printf "%s\n" "### Что сделано" "- ..." "" "### Проверки" "- [ ] При необходимости файлы названы с версией (_vX.Y[.Z])" "- [ ] Обновлён соответствующий CHANGELOG.md" "" "### Ссылки" "- ADR/Issue: ..." > .github/PULL_REQUEST_TEMPLATE.md
          printf "%s\n" "* @MIK4UA" > .github/CODEOWNERS

      - name: Commit
        run: |
          git add -A
          git commit -m "${{ github.event.inputs.commit_message }}" || echo "Nothing to commit"

      - name: Push
        run: |
          git push "https://x-access-token:${{ steps.app_token.outputs.token }}@github.com/${{ github.repository }}.git" HEAD:${{ github.event.inputs.branch }}

      - name: Create PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ steps.app_token.outputs.token }}
          branch: ${{ github.event.inputs.branch }}
          title: "chore: bootstrap LIK repository structure"
          body: "Автоматический PR с инициализацией структуры и базовых файлов."
          base: main
